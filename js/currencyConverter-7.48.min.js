// File: currencyConverter.js
var CurrencyConverter=function(){function a(a){var b,c=0;2==a?(c=$("#DropdownBtn1 > input").attr("data-value"),b=$("#DropdownList2").data("type")):(c=$("#DropdownBtn2 > input").attr("data-value"),b=$("#DropdownList1").data("type")),$.ajax({url:"/currencyconverter/service/LoadCurrencyList",async:!1,type:"GET",data:{fromCurrency:c,listType:b},success:function(b){$("#DropdownList"+a+" li").remove(),$("#DropdownList"+a).append(b)}})}function b(a,b,d){var e=$("#DropdownBtn1 > input").attr("data-value"),g=$("#DropdownBtn2 > input").attr("data-value"),h=i($("#amount1").val()),j=i($("#amount2").val()),k="";window.ccDatePickerInstance&&(k=d||$.datepicker._getFromToDates(window.ccDatePickerInstance,"yy-mm-dd").dateFromStr),e==g?(1==a&&($("#amount2").val($("#amount1").val()),$("#rate1").html(""),$("#rate2").html("")),2==a&&($("#amount1").val($("#amount2").val()),$("#rate1").html(""),$("#rate2").html(""))):$.ajax({url:"/currencyconverter/service/RunConvert",async:!1,type:"GET",data:{fromCurrency:e,toCurrency:g,fromAmount:h,toAmount:j,currencyType:a,refreshCharts:b,dateConvert:k},success:function(b){var d;"null"==b||(obj=JSON.parse(b),d=f(obj.calculatedAmount),2==a?$("#amount1").val(d):$("#amount2").val(d),c(obj),$.isEmptyObject(obj.dataCharts)?$.isEmptyObject(obj.noDataChart)||($("#curConvChartNoData").removeClass("displayNone").html(obj.noDataChart),$("#curConvChartMain > DIV").addClass("displayNone")):($("#curConvChartMain > DIV").removeClass("displayNone"),$("#converter_chart_data").attr("data-pair_id",obj.dataCharts.chartData.pairID).attr("pair",obj.dataCharts.chartData.pairID),$("#converter_chart_data").attr("data-pair_url",obj.dataCharts.chartData.pairLink),$("#cc_daily_range_low").html(obj.dataCharts.daily_range.low),$("#cc_daily_range_high").html(obj.dataCharts.daily_range.high),$("#dailyCurPos").css("left",obj.dataCharts.daily_percentage+"%"),$("#cc_year_range_low").html(obj.dataCharts.wk52_range.low),$("#cc_year_range_high").html(obj.dataCharts.wk52_range.high),$("#weeklyCurPos").css("left",obj.dataCharts.wk52_percentage+"%"),$('[name="cc_current_rate"]').html(obj.dataCharts.current_rate),$("#curConvChartNoData").addClass("displayNone")),$("#downloadHistoryDatePickerWrapper")._toggleShow(obj.date_picker.is("show")),window.savedDownloadParams.curr_id=obj.convertPairID)}})}function c(a){if("hide"==a.date_picker?(d(new Date),$("#flatDatePickerCanvasHol").addClass("disabled").css("pointer-events","none"),$("#dateConvert").removeClass("dateRange")):"none"==$("#flatDatePickerCanvasHol").css("pointer-events")&&(d(new Date),$("#flatDatePickerCanvasHol").removeClass("disabled").css("pointer-events","auto"),$("#dateConvert").addClass("dateRange")),$("#rate1").html(a.baserate1),$("#rate2").html(a.baserate2),a.newDate&&a.newDate!=$("#dateConvert").text()&&$("#picker").trigger("setMinimalDate",[a.newDate]),a.h2header){var b=a.h2header;$.isEmptyObject(a.dataCharts)||(b="<a href='"+a.dataCharts.chartData.pairLink+"'>"+a.h2header+"</a>"),$("#curConvHeader").html(b)}}function d(a){var b=window.siteData.datepicker.formatShort;void 0!==b&&(a=$.datepicker.formatDate(b.replace("d","dd").replace("m","mm").replace("y","yy"),a),$("#picker").datepicker("setDate",a),$("#dateConvert").text(a))}function e(){if($("#currencyConv1").attr("data-value")==$("#currencyConv2").attr("data-value"))return void(G=!1);if(!G){G=!0;var a,b=s.children("input").attr("data-value"),d=v.children("input").attr("data-value"),e=i(C.val());if(null===$.datepicker._curInst)a="";else{a=$.datepicker._getFromToDates($.datepicker._curInst,"yy-mm-dd").dateFromStr}if(b==d)D.val(C.val()),$("#rate1").html(""),$("#rate2").html("");else{var g=t.attr("class"),h=u.html(),j=s.children("input").attr("value"),k=y.html(),l=w.attr("class"),m=x.html(),n=v.children("input").attr("value"),o=z.html();t.removeAttr("class").attr("class",l),u.html(m),s.children("input").attr("value",n).attr("data-value",d),y.html(o),w.removeAttr("class").attr("class",g),x.html(h),v.children("input").attr("value",j).attr("data-value",b),z.html(k);var p=A.html(),q=B.html();A.html("").html(q),B.html("").html(p),dropdownSelector1.refresh(),dropdownSelector2.refresh(),dropdownSelector2.selectByValue(dropdownSelector2.selectedDataValue()),dropdownSelector1.selectByValue(dropdownSelector1.selectedDataValue()),$.ajax({url:"/currencyconverter/service/RunConvert",async:!1,type:"GET",data:{fromCurrency:d,toCurrency:b,fromAmount:e,currencyType:1,refreshCharts:!0,dateConvert:a},success:function(a){var b;if("null"==a)D.val(0);else{obj=JSON.parse(a),b=f(obj.calculatedAmount),D.val(b),c(obj);var d=$("#curConvChartMain > DIV");$.isEmptyObject(obj.dataCharts)?$.isEmptyObject(obj.noDataChart)||($("#curConvChartNoData").removeClass("displayNone").html(obj.noDataChart),d.addClass("displayNone")):(d.removeClass("displayNone"),$("#converter_chart_data").attr("data-pair_id",obj.dataCharts.chartData.pairID).attr("pair",obj.dataCharts.chartData.pairID).attr("data-pair_url",obj.dataCharts.chartData.pairLink),$("#cc_daily_range_low").html(obj.dataCharts.daily_range.low),$("#cc_daily_range_high").html(obj.dataCharts.daily_range.high),$("#dailyCurPos").css("left",obj.dataCharts.daily_percentage+"%"),$("#cc_year_range_low").html(obj.dataCharts.wk52_range.low),$("#cc_year_range_high").html(obj.dataCharts.wk52_range.high),$("#weeklyCurPos").css("left",obj.dataCharts.wk52_percentage+"%"),$('[name="cc_current_rate"]').html(obj.dataCharts.current_rate),$("#curConvChartNoData").addClass("displayNone")),$("#downloadHistoryDatePickerWrapper")._toggleShow(obj.date_picker.is("show")),window.savedDownloadParams.curr_id=obj.convertPairID,$("#swapButton").removeClass("focus").addClass("focus"),setTimeout(function(){E.trigger("chartTabChanged")},10)}}}).always(function(){setTimeout(function(){G=!1},100)})}}}function f(a){var b,c;return c=+(""+a).replace(window.siteData.decimalPoint,"."),b=$.getNumbersAfterDecimalPoint(c),c.toFixed(b).replace(".",window.siteData.decimalPoint)}function g(a,b,c){allowDel=190,","==b&&(allowDel=188),numbersArr=c.split(b);try{var d=a.which?a.which:a.keyCode;return!!d&&(d>47&&d<58||(d>95&&d<106||(d<32&&13!=d&&9!=d||d>31&&d==allowDel||110==d)))}catch(e){}}function h(a,b,c){allowDel=46,","==b&&(allowDel=44);var d=".";","==b&&(d+=",");try{var e=a.which||a.keyCode;if(e>31&&(e<48||e>57)){for(var f=0,g=d.length;f<g;f++)if(d[f]==String.fromCharCode(e)){for(var h=0;h<d.length;h++)if(-1!=c.indexOf(d[h]))return!1;return!(i(c+String.fromCharCode(a.keyCode))>999999999)}return!1}return!(i(c+String.fromCharCode(a.keyCode))>999999999)}catch(j){}}function i(a){return result=0,a&&(result=a.replace(",",".")),!isNaN(parseFloat(result))&&isFinite(result)&&result-0==result?parseFloat(result):0}function j(a,b){return!!a&&(result=a,","==b&&(result=a.replace(",",".")),!(result.length>9)&&!(isNaN(parseFloat(result))||!isFinite(result)))}function k(b){1==b&&(a(2),dropdownSelector2.refresh()),2==b&&(a(1),dropdownSelector1.refresh())}function l(a,c){element=a.slice(-1);var d=$("#DropdownList"+element+' [data-value="'+c+'"]').attr("currencysymbol");$("#amountContainerMain"+element+" label").html(d),$("#amountContainerMain"+element).removeClass("focus").addClass("focus"),$("#amount"+element).focus(),k(element),b(1,!0),setTimeout(function(){$("#converterChart").trigger("chartTabChanged")},10)}function m(a,c,d){var e=$(c).attr("id");e=e.slice(-1),q&&clearTimeout(q),g(a,d,$(c).val())&&(q=setTimeout(function(){b(e,!1)},300))}function n(a){b(1,!1,a)}function o(a,c){var d=$(a).attr("id");d=d.slice(-1),setTimeout(function(){if(!j($("#amount"+d).val(),c)){var a=$("#amount"+d).val();a=a.substr(0,9),$("#amount"+d).val(a),1==d?$("#amount2").val(0):$("#amount1").val(0)}b(d,!1)},20)}function p(a,c){var d=$(a).attr("id");d=d.slice(-1);var e=c.which?c.which:c.keyCode;r&&clearTimeout(r),46==e&&(r=setTimeout(function(){b(d,!1)},300))}var q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F=$(document),G=!1;F.ready(function(){s=$("#DropdownBtn1"),t=s.children("[before-input-element]"),u=s.children("[after-input-element]"),v=$("#DropdownBtn2"),w=v.children("[before-input-element]"),x=v.children("[after-input-element]"),y=$("#amountContainerMain1 > label"),z=$("#amountContainerMain2 > label"),A=$("#DropdownList1"),B=$("#DropdownList2"),C=$("#amount1"),D=$("#amount2"),E=$("#converterChart")}),this.onAmountChangeEvent=m,this.onCurrencySelectEvent=l,this.onlyNumbers=h,this.switchCurrency=e,this.onDateChangeEvent=n,this.validateValueOnPaste=o,this.validateOnKeyDown=p};