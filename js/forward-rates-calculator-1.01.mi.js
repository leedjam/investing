// File: forward-rates-calculator.js
var ForwardRates=function(){function a(a){var b=0;return a&&(b=a.replace(",",".")),!isNaN(parseFloat(b))&&isFinite(b)&&b-0==b?parseFloat(b):0}function b(a){return isNaN(a)?"":(n=a.toString().split("."),n[0].replace(/\B(?=(\d{3})+(?!\d))/g,window.thousandSep)+(n.length>1?window.decimalSep+n[1]:""))}function c(){return{_spot_price:a($("#spotPrice").val()),_spot_date:$("#spot_date").val(),_base_interest_rate:a($("#noc").val()),_forward_date:$("#forward_date").val(),_quote_interest_rate:a($("#quote_interest_rate").val()),_days:a($("#days").val()),_basis:a($("#basis").val()),_forward_rate:$("#p_l").text(),_forward_points:$("#p_l_ticks").val(),_forward_pips:$("#p_l_pips").val(),$containers:{_spot_price:$("#spotPrice"),_spot_date:$("#spot_date"),_base_interest_rate:$("#noc"),_forward_date:$("#forward_date"),_quote_interest_rate:$("#quote_interest_rate"),_days:$("#days"),_basis:$("#basis"),_forward_rate:$("#p_l"),_forward_points:$("#p_l_ticks"),_forward_pips:$("#p_l_pips")}}}function d(a,b){return a.$containers._spot_price.val(b.spot_price),a.$containers._base_interest_rate.val(b.base_currency),a.$containers._quote_interest_rate.val(b.counter_currency),t}function e(){var a=t.getValues(),b=a._spot_price,c=a._base_interest_rate,d=a._quote_interest_rate,e=a._days,f=a._basis;return a._forward_rate=b*Math.pow((1+d/100)/(1+c/100),e/f),a._forward_points=b*(d-c)*e/(c*e+100*f),a._forward_pips=1e4*a._forward_points,a}function f(a){a.$containers._forward_rate.text(b(a._forward_rate.toFixed(6))),a.$containers._forward_points.text(b(a._forward_points.toFixed(6))),a.$containers._forward_pips.text(b(a._forward_pips.toFixed(2)))}function g(){var a=t.getValues();a.$containers._days.on("js-blur",function(a,b,c,d,e){if(d){var f=$("#spotPicker").datepicker("getDate");$("#forwardPicker").datepicker("setDate",f.addDays(c))}})}function h(){var a=t.getValues();m(),p(a.$containers._days,1,10800),q(a.$containers._spot_price),r(a.$containers._base_interest_rate),r(a.$containers._quote_interest_rate),g(),j(),i(),o()}function i(){$("#forwardCalculateButton").click(function(a){if(l(),!$(this).is(".disabled")){var b=e(t.getValues());f(b)}})}function j(){var a=t.getValues();$(".clearContent").click(function(){u.val("").attr("prevvalue",""),a.$containers._spot_price.val(""),a.$containers._base_interest_rate.val(""),a.$containers._quote_interest_rate.val(""),a.$containers._forward_rate.text(""),a.$containers._forward_points.text(""),a.$containers._forward_pips.text(""),a.$containers._days.val(s),a.$containers._basis.find("option:first").attr("selected",!0),$("#spotPicker").datepicker("setDate",Date()),$("#forwardCalculateButton").addClass("disabled"),$("#forwardPicker").datepicker("setDate",(new Date).addDays(s)),setTimeout(function(a){u.val("").attr("prevvalue",""),$("#pair_id").val(1)},200)})}function k(){var a=t.getValues();a.$containers._forward_rate.text(""),a.$containers._forward_points.text(""),a.$containers._forward_pips.text("")}function l(){var a=$("#spotPicker").datepicker("getDate"),b=$("#forwardPicker").datepicker("getDate"),c=Math.round((b-a)/864e5);$("#days").val(c)}function m(){u.on("keyup",function(){""==$(this).val()&&$("#forwardCalculateButton").addClass("disabled")}),u.on("pairSelected",function(a,b){$("#pair_id").val(b),$("#forwardCalculateButton").removeClass("disabled");var c=t.getValues(),d=$("#spotPicker").datepicker("getDate"),e=$.datepicker.formatDate("yy-mm-dd",d);$.getJSON("/tools/Service/forwardrate",{curr_pair_id:b,spot_date:e},function(a){t.writeBasicParams(c,a)}),k()})}function o(){$("#spotPicker").on("spotDateChanged",function(a,b,c){var d=t.getValues(),e=$("#pair_id").val();k(),$.getJSON("/tools/Service/forwardrate",{curr_pair_id:e,spot_date:c},function(a){t.writeBasicParams(d,a)})})}function p(b,c,d){c=c||Number.MIN_VALUE,d=d||Number.MAX_VALUE,b.on("keypress",function(c){var e=!0,f=[".","-","+"],g=String.fromCharCode(c.keyCode);f.indexOf(g)>-1&&(c.preventDefault(),e=!1),("0">g||g>"9")&&(c.preventDefault(),e=!1);var h=b.val();""!=h&&(h=a(h),(h+.1>d||h+g>d)&&(c.preventDefault(),e=!1)),$(this).trigger("js-key-pressed",[$(this),g,e])}),b.on("focus",function(a){}),b.on("blur",function(b){var d=!0;($(this).val()<c||""==$(this).val())&&(d=!1),$(this).trigger("js-blur",[$(this),a($(this).val()),d,""==$(this).val()])})}function q(b,c,d){function e(a,b,c){var d="";c&&(d=window.decimalSep);var e=b.which?b.which:b.keyCode;if(e>31&&(48>e||e>57)){for(var f=0,g=d.length;g>f;f++)if(d[f]==String.fromCharCode(e)){for(var h=0;h<d.length;h++)if(-1!=a.value.indexOf(d[h]))return b.preventDefault(),!1;return!0}return b.preventDefault(),!1}return!0}c=c||Number.MIN_VALUE,d=d||Number.MAX_VALUE,b.on("keypress",function(a){var b=e(this,a,!0);b||a.preventDefault(),$(this).data("isValid",b)}),b.on("blur",function(b){var e=$(this).data("isValid")?$(this).data("isValid"):!0;($(this).val()<c||""==$(this).val()||$(this).val()>d)&&(e=!1),$(this).trigger("js-blur",[$(this),a($(this).val()),e,""==$(this).val()])})}function r(b,c,d){function e(a,c,d,e){"-"!=a.value.charAt(0)&&b.data("hasMinus",!1);var f=window.getSelection().toString();if(e&&45==c.keyCode&&(f==$(a).val()||""==$(a).val()||0==$(a)[0].selectionStart))return b.data("hasMinus",!0),!0;var g="";d&&(g=[window.decimalSep]);var h=c.which?c.which:c.keyCode;if(h>31&&(48>h||h>57)){for(var i=0,j=g.length;j>i;i++)if(g[i]==String.fromCharCode(h)){for(var k=0;k<g.length;k++){var l=b.data("hasMinus")?a.value.substr(1):a.value;if(-1!=l.indexOf(g[k]))return!1}return!0}return!1}return!0}c=c||Number.MIN_VALUE,d=d||Number.MAX_VALUE,b.on("keypress",function(a){var b=e(this,a,!0,!0);b||a.preventDefault(),$(this).data("isValid",b)}),b.on("blur",function(b){var e=$(this).data("isValid")?$(this).data("isValid"):!0;($(this).val()<c||""==$(this).val()||$(this).val()>d)&&(e=!1),$(this).trigger("js-blur",[$(this),a($(this).val()),e,""==$(this).val()])}),$("#noc").keypress(function(a){if(!(this.value.selectionEnd-this.value.selectionStart>1)&&a.keyCode>=48&&a.keyCode<=57){var b=String.fromCharCode(a.keyCode);"9"==b&&(b=""),parseInt($(this).val()+b)<=-99&&a.preventDefault()}})}var s=360,t=this,u=$("#forexSearchText");t.getValues=c,t.writeBasicParams=d,t.writeForwardResults=f,t.calculateForwardRates=e,t.handle=h};$(document).ready(function(){var a=new ForwardRates;a.handle()});