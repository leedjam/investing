// File: Filters.js
function isNumeric(a){return!isNaN(parseFloat(a))&&isFinite(a)}function isInArray(a,b){return b.indexOf(a)>-1}function dropDownFilter(a,b,c){b?filters.addDropDownFilter(a,b,c):filters.removeFilter(a)}function checkboxFilter(a,b,c){var d=$(b).val();$(b).attr("checked")?filters.addCheckboxFilterAndSend(a,d,c):filters.removeCheckboxFilterAndSend(a,d)}function checkCreditCards(a){$.each($("input[js-extraparam='Credit']"),function(b,c){$("input[js-function='checkCreditCards']").is(":checked")?($(c).attr("checked",!0),filters.addCheckBoxFilter(a,$(c).val(),"checkbox")):($(c).attr("checked",!1),filters.removeCheckboxFilter(a,$(c).val()))}),filters.askForData(filters.getFilterStatus(),1)}var Filters=function(){var a={};this.addRangeFilter=function(b,c,d){if(!b)throw new Error("Invalid key type "+b+" given to filter stack");if(!c&&0!==c)throw new Error("Invalid minimal value given to filter stack range");if(!d&&0!==d)throw new Error("Invalid maximal value given to filter stack range");void 0===a[b]?a[b]={min:c,max:d,type:"range"}:(a[b].min=c,a[b].max=d,a[b].type="range"),this.askForData(a,1)},this.addQueryFilter=function(b,c){void 0===a[b]||$.isEmptyObject(a[b])?a[b]={query:c,type:"query"}:(a[b].val=c,a[b].type="query"),this.askForData(a,1)},this.addDropDownFilter=function(b,c,d){void 0===a[b]||$.isEmptyObject(a[b])?a[b]={val:c,type:d}:(a[b].val=c,a[b].type=d),this.askForData(a,1)},this.removeFilter=function(b){a[b]={},this.askForData(a,1)},this.addCheckboxFilterAndSend=function(b,c,d){this.addCheckBoxFilter(b,c,d),this.askForData(a,1)},this.getFilterStatus=function(){return a},this.addCheckBoxFilter=function(b,c,d){void 0===a[b]||$.isEmptyObject(a[b])?(a[b]={val:[c]},a[b].type=d):(a[b].val.push(c),a[b].type=d)},this.removeCheckboxFilter=function(b,c){var d=a[b].val.indexOf(c);d>-1&&a[b].val.splice(d,1)},this.removeCheckboxFilterAndSend=function(b,c){this.removeCheckboxFilter(b,c),this.askForData(a,1)},this.askForData=function(a,b){var c=$("#BrokerType").val();$("#directoryTable").hide(),$("#directoryLoader").show(),$.ajax({url:"/brokers/service/getFilteredData",type:"GET",data:{data:a,type:c,page:b},dataType:"json",error:function(a,b,c){throw c},success:function(a){$("#directoryLoader").hide();var b=$("#sample");$("#directoryTable").find("tbody > tr:not(#sample)").remove();var d=$("#directoryTable").find("tbody"),e=$("#js-cdn-link").val();$.each(a.data,function(a,f){var g=b.clone();g.attr("id","");var h=f.affurls,i="";if(f.logo){if(h){if(h.hasOwnProperty("logoUrl"))var j=f.affurls.logoUrl}else var j=f.brokerLink;i=$("<a>").attr("href","javascript:void(0);").html($("<img>").attr("src",e+f.logo).on("click",function(){window.open(j,"_blank")}))}var k=$("<a>").attr("href",f.brokerLink).html(g.find(".js-broker-logo > a:last").html());if(g.find(".js-broker-logo").html(i).append(k),g.find(".js-brokerName").attr("href",f.brokerLink),g.find(".js-brokerName").html(f.brokerName),f.minimumDeposit>=0?g.find(".js-minimumDeposit").html("$"+f.minimumDeposit):g.find(".js-minimumDeposit").html(""),g.find(".js-second-column").html()){var l=g.find(".js-second-column").attr("data-type");if("optionProfitability"==l)g.find(".js-second-column").html(f[l]);else{var m=g.find(".js-second-column").html();if(m){var n=m.replace(/[0-9\.]+/g,"",f[l]);f[l]>=0?g.find(".js-second-column").html(f[l]+n):g.find(".js-second-column").html("")}}}if(f.extraMsg?g.find(".js-extraMsg").html(f.extraMsg):g.find(".js-extraMsg").remove(),"Premium"==f.package[c]){var o=b.find(".js-brokerName").html();$.each(g.find(".js-features > a"),function(a,b){var c=$(b).attr("feature-type");if(f.features&&c in f.features&&f.features[c]){var d=$(b).attr("href").replace(o,f.brokerNameModReWrite);g.find(".js-features > a[feature-type='"+c+"']").attr("href",d)}else g.find(b).remove()})}else g.find(".js-features").remove(),g.find(".js-brokerName").parents("TD").removeClass("withFeatures");f.description&&"Standard"!=f.package[c]?g.find(".js-description").html(f.description.substring(0,$("#desc_trim").val())):g.find(".js-description").remove(),h&&h.applyUrl&&!f.mediaExpire&&f.show_aff_button?g.find(".js-apply-btn").on("click",function(){window.open(f.affurls.applyUrl,"mywindow")}):g.find(".js-apply-btn").remove(),f.extraMsg?g.find(".js-extra-msg").html(f.extraMsg):g.find(".js-extra-msg").hide();var p=g.find(".js-regulators-list").html();f.regulators?(p&&g.find(".js-regulators-list").html(p.replace(/[0-9\.]+/g,f.regulators.length)),f.regulators.length&&(g.find(".js-regulators").html(""),$.each(f.regulators,function(a,b){g.find(".js-regulators").append("<li>"+b.name+" ("+b.countryName+")</li>")}))):g.find(".js-regulators-div").hide(),"Premium"==f.package[c]?g.addClass("promoted"):"Sponsored"==f.package[c]?g.addClass("promoted2"):g.removeClass(),g.removeClass("displayNone"),d.append(g)}),$("#directoryTable").show(),$("#pagination").html(a.pagination)}})}},filters=new Filters;$(window).on(window.checkboxWidgetEventName,function(a,b,c){switch(b){case"assetTypes":case"orderTypes":checkboxFilter(b,c,"checkboxSlop");break;case"accounts":case"otherFeatures":checkboxFilter(b,c,"checkboxExists");break;default:checkboxFilter(b,c,"checkbox")}}),$(window).on(window.dropdownWidgetEventName,function(a,b,c){switch(b){case"brokerTypes":dropDownFilter("kind",$(c).val(),"dropdown");break;case"regulators":dropDownFilter("regulators",$(c).val(),"dropdown");break;case"platforms":dropDownFilter("usedPlatforms",$(c).val(),"dropdown");break;default:console.log("default")}}),$(window).on(window.checkboxWidgetEventExtraFunction,function(a,b,c,d){window[c](b)}),$(function(){window.directoryPaginationClick=function(a){filters.askForData(filters.getFilterStatus(),a),window.scrollTo(0,0)},$(window).on(window.rangeFilterWidgetEventName,function(a,b,c,d){filters.addRangeFilter(b,c,d)}),$(window).on(window.removeRangeFilterWidgetEventName,function(a,b){filters.removeFilter(b)})});