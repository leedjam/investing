// File: absolute-floated-popup.js
function AbsoluteFloatedPopup(a){function b(a){for(var b=0;!a.is(n[0]);)b+=a.position().top-(a.outerHeight()-a.height()),a=a.offsetParent();return b}function c(a){return a.offsetParent().height()-Number(a.css("top").replace("px",""))-A-z}function d(){var c=$(window).height()+o.scrollTop();return b(a)-z+x<c}function e(){return b(a)>y}function f(a,b){return b.width()-a}function g(){var a={top:p.offset.top+r/2-z};return u?a.right=f(p.position.left,p.$offsetParent)+s:a.left=p.offset.left+s,a}function h(a,b){a.addClass("topCorner"),b&&a.addClass("grayArrow")}function i(b,d,f){b.addClass("bottomCorner"),a.css({top:"auto",bottom:c(a)}),e()||(h(b.removeClass("bottomCorner"),f),a.removeAttr("style").offset(d))}function j(){w.trigger("hideInnerWidgets")}function k(b,c){m(b),p.$offsetParent.append(a),j();var e=g(p.offset,p.$offsetParent);v.show().getEl().removeAttr("style").css("opacity",0).offset(e),e.right&&a.css("right",e.right),a.removeClass("displayNone bottomCorner grayArrow topCorner"),setTimeout(function(){d()?h(a,c):i(a,e,c),a.css("opacity",1),t=!0,q=p.$el},1),p.$el.addClass("active")}function l(){t&&(q&&q.removeClass("active"),n.append(a),t=!1)}function m(a){r&&s||(r=a.outerHeight(!0),s=a.outerWidth(!0),u&&(s-=Number(a.css("margin-right").replace("px",""))));var b=a.parents("tr");p={$el:a,$row:b,$offsetParent:a.offsetParent(),position:a.position(),offset:a.offset()}}var n=$("body"),o=$(document);n.append(a);var p,q,r,s,t=!1,u="rtl"===$("html").attr("dir"),v=new components.TooltipPopup(a),w=new components.Subscriber,x=a.removeClass("displayNone").outerHeight(),y=73,z=19,A=10;a.addClass("displayNone"),v.subscribe("hide",l),this.isShown=function(){return t},this.show=k,this.hide=l,this.events=w.events}
// File: user-alerts-opener.js
window.showChartInstrumentAlert=function(a){var b={data:{pairId:a,alert_trigger:"Price"}};window.isChartAlertPopup=!0,loader([{type:"component",value:"UserAlertsOpener"}]).ready(function(a){window.instrumentsChartUserAlert=new a({absolutePosition:!1,defaultAlertData:{alert_trigger:"Price",hideEarnings:!0}})}),window.getInstrumentDataForChartAlert(b.data,function(a){$.extend(b.data,a),instrumentsChartUserAlert.showAlert(b),b.hasData=!0})},function(a,b,c){function d(a,c){b.ajax({url:"/useralerts/service/getInstrumentData",data:{pair_ID:a.pairId},type:"post",dataType:"json"}).done(function(a){a.avg_volume&&(a.volume=a.avg_volume),a.last&&(a.value=a.last),a.hideVolume=!a.volume||a.volume.is("0"),c(a)})}c.UserAlertsOpener=function(e){function f(){i&&i.unbind("click"),i=l.find(n),i.each(function(a){var c=i.eq(a),d=c;j&&(d=d.find(".js-plus-icon"));var e={data:b.extend({pairId:c.attr("data-pair-id")},o),$el:d};d.bind("click",g.bind(e))})}function g(a){var c=this;return q.popup.getEl().is(a.target)||q.popup.getEl().find(a.target).length?!0:!j&&q.popup.isShown()&&p===c?(q.popup.hide(),void(p=null)):j&&j.isShown()&&p===c?(j.hide(),void(p=null)):(s.trigger("clicked",c),void(c.hasData?h(c):d(c.data,function(a){b.extend(c.data,a),h(c),c.hasData=!0})))}function h(a){j?setTimeout(function(){j.show(a.$el,!0),q.form.setDefaultParams(a.data),q.popup.show()},1):(a.$el&&q.popup.appendTo(a.$el,!0),q.form.setDefaultParams(a.data),q.popup.show()),s.trigger("open",a),p=a}e=e||{};var i,j,k,l=e.$wrapper||a,m=e.$popup||l.find(".js-user-alert-popup:eq(0)"),n=e.buttonsSelector||".js-injected-user-alert-container",o=e.defaultAlertData||{alert_trigger:"Price"},p=null,q={},r=b.extend({useGeneralOverlay:!1},instrumentPopupParams.globals),s=new c.Subscriber,t=instrumentPopupParams.globals.createPopup&&instrumentPopupParams.globals.useGeneralOverlay;e.absolutePosition&&(j=new AbsoluteFloatedPopup(m)),t&&(k=b(".js-chart-alert"),b(".wrapper").append(k)),q.texts=r.texts,q.rowTexts=r.rowTexts,q.popup=new UserAlertsPopup(t?k:m,r),q.form=new InstrumentUserAlerts(null,null,q.texts,q.popup,{disableRemove:!1}),q.form.setDefaultParams({}),q.form.subscribe(function(){s.trigger("submit",p),q.form.showSuccessMessage(),p.$el&&p.$el.addClass("hasAlert"),p=null}),j&&q.popup.subscribeToClose(function(){j.hide(),s.trigger("close")}),this.events=s.events,this.bindEvents=f,this.showAlert=h},window.getInstrumentDataForChartAlert=d}($(document),jQuery,window.components);