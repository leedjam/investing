// File: profit-calculators.js
function FPProfitCalculators(){this.someFlag=!1,this.specialPairs=Array(),this.allCurrencies=Array(),this.numberFormat="us"}function switchProfitCalculator(a){var b=a.id;"futuresprofit"==b?($("#futures_profit_calculator").removeClass("displayNone"),$("#forex_profit_calculator").addClass("displayNone")):($("#futures_profit_calculator").addClass("displayNone"),$("#forex_profit_calculator").removeClass("displayNone"))}FPProfitCalculators.prototype={submitProfitCalculator:function(){$("#forexCalculateButton").hasClass("disabled")||validateNumeric("#calc_form input[name='OTP'],#calc_form input[name='CTP'],#calc_form input[name='trade_size']")&&this.profit_calculator($("#calc_form select[name='acc_curr'] :selected").val(),$("#calc_form select[name='acc_curr'] :selected").text(),$("#forex_pair_id").val(),unFormat("#calc_form input[name='OTP']"),unFormat("#calc_form input[name='CTP']"),$("#calc_form select[name='buy']").val(),unFormat("#calc_form input[name='trade_size']"),$("#calc_form select[name='curr_pair'] :selected").val())},profit_calculator:function(a,b,c,d,e,f,g,h){0!=!isNaN(d)&&0!=!isNaN(e)&&($("#msgboxtotal").hide(),$("#calculating").fadeIn(100),$("#msgboxtotal").empty(),$.get("/tools/Service/profit",{acc_curr:a,curr_pairs:c,otp:d,ctp:e,buy:f,second_pair_id:h,trade_size:g},function(c){c.length>0&&$("#msgboxtotal").fadeTo(200,.1,function(){if("error"==c)$(this).html("Error Occured!").removeClass().addClass("messageboxerror_with_border").fadeTo(900,1);else{var d=new Array;d[17]="&#128;",d[4]="CHF",d[2]="&#165;",d[15]="C$",d[3]="&#163;",d[1]="AUD",d[5]="NZD",d[12]="&#36;",d[79]="RUB",d[9]="TRY",d[14]="Mex$",d[8]="z&#322;",d[30]="R$",d[13]="SEK",d[23]="&#8362;",d[26]="SAR",d[35]="BRL",d[47]="EGP",d[36]="BHD",d[25]="KWD",d[28]="KRW",d[41]="&#165;",d[20]="HKD",d[87]="VND",d[55]="&#8360;",d[10]="&#3647;",$("#calculating").hide(),"-"!=c[0]?$(this).html(d[a]+c).fadeIn(100).fadeTo(300,1):$(this).html("-"+d[a]+c.substr(1)).fadeIn(100).fadeTo(300,1),$("#msgbox").html(b).fadeIn(100).fadeTo(300,1)}})}))},checkEnterForForexSearch:function(a){var b=this;if(13==a.keyCode){this.someFlag=!0;var c=0;try{c=b.resultsData[b.rowNumber-1].pair_ID}catch(d){try{c=b.resultsData[0].pair_ID}catch(d){}}if(c){$("#forexSearchPopupResults").addClass("displayNone"),$("#forexSearchPopupResults").html(""),b.searchDeafaultVale="";var e="";try{e=b.resultsData[b.rowNumber-1].symbol.replace(/<\/?[^>]+(>|$)/g,"")}catch(d){try{e=b.resultsData[0].symbol.replace(/<\/?[^>]+(>|$)/g,"")}catch(d){}}this.forexPairSelected(c,e),$("#forex_pair_id").val(c)}return!1}},forexPairSelected:function(a,b){$("#forex_OTP").val(""),this.clearForexForm();var c=$("#forexSearchText");c.val(b),c.attr("prevvalue",b),this.getLastPairsCurr(a),this.validateForexCalculateButton()},validateForexCalculateButton:function(){$("#CTP").val()&&$("#forex_trade_size").val()&&$("#forex_OTP").val()&&$("#forexSearchText").val()?$("#forexCalculateButton").hasClass("disabled")&&$("#forexCalculateButton").removeClass("disabled"):$("#forexCalculateButton").hasClass("disabled")||$("#forexCalculateButton").addClass("disabled")},clearForexForm:function(){var a=$("#forexSearchText");a.val(""),a.attr("prevvalue",""),$("#msgboxtotal").html(""),$("#forex_OTP").val(""),$("#forex_buy").val(""),$("#forex_trade_size").val("1000"),$("#CTP").val("")},getLastPairsCurr:function(a){0!=!isNaN(a)&&$.get("/tools/Service/GetLastRateByPair",{pair_id:a,format:this.numberFormat},function(b){var c=JSON.parse(b);$("#CTP").val(c.rate),$("#forexSearchText").trigger("pairSelected",[a])})},clearProfitForm:function(a){$("#pair_id").val(""),$("#curr1").val(""),$("#rate").val(""),$("#symbol").val("");var b=$("#fpcSearchText");b.val(""),b.attr("prevvalue",""),a||$("#fpcSearchText").prev().remove(),$("#p_l").html(""),$("#p_l_ticks").html(""),$("#p_l_points").html(""),$("#tick_size").html(""),$("#tick_value").html(""),$("#noc").val(""),$("#contract_size").html(""),$("#point_value").html(""),$("#open_price").val(""),$("#close_price").val(""),$("#open_price").attr("oldval",""),$("#close_price").attr("oldval","")},futuresPairSelected:function(a,b){$("#pair_id").val(a);var c=!1;if("undefined"!=typeof this.specialPairs[a])for(c=!0,$("#open_price_parts").html(""),$("#open_price_parts").removeClass("displayNone"),$("#open_price_parts").parent().addClass("small"),$("#close_price_parts").html(""),$("#close_price_parts").removeClass("displayNone"),$("#close_price_parts").parent().addClass("small"),i=0;i<this.specialPairs[a];i++)$("#open_price_parts").append("<option value="+i+">"+i+"/"+this.specialPairs[a]+"</option>"),$("#close_price_parts").append("<option value="+i+">"+i+"/"+this.specialPairs[a]+"</option>"),$("#open_price_parts").attr("base",this.specialPairs[a]),$("#close_price_parts").attr("base",this.specialPairs[a]);else $("#open_price_parts").addClass("displayNone"),$("#open_price_parts").parent().removeClass("small"),$("#close_price_parts").addClass("displayNone"),$("#close_price_parts").parent().removeClass("small");$.ajax({url:"/tools/Service/get-pair-data-for-futures",data:{pair_id:a},success:function(a){if(a.length>0){var d=JSON.parse(a);if(this.clearProfitForm(!0),d.tick_size&&$("#tick_size").html(this.removeThousandsSeparator(d.tick_size)),d.tick_value&&$("#tick_value").html(this.removeThousandsSeparator(d.tick_value)),d.contract_size&&$("#contract_size").html(d.contract_size),d.point_value){var e=d.point_value.split("=");$("#point_value").html(e[e.length-1].trim())}if(d.last){var f=this.removeThousandsSeparator(d.last);c?$("#close_price").val(""):$("#close_price").val(f)}d.currency_ID&&$("#curr1").val(d.currency_ID),this.updateRate();var g=$("#fpcSearchText");b=b.replace(/&amp;/g,"&"),g.val(b),g.attr("prevvalue",b),this.validateProfitCalculateButton()}},context:this})},removeThousandsSeparator:function(a){var b;return b="us"==this.numberFormat?",":".",a.split(b).join("")},isNumberKey:function(a,b,c){var d="";c&&(d+="us"==this.numberFormat?".":".,");var e=b.which?b.which:b.keyCode;if(e>31&&(48>e||e>57)){for(var f=0,g=d.length;g>f;f++)if(d[f]==String.fromCharCode(e)){for(var h=0;h<d.length;h++)if(-1!=a.value.indexOf(d[h]))return!1;return!0}return!1}return!0},updateRate:function(){$("#curr1").val()&&$.get("/tools/service/get-rate-and-symbol",{curr1:$("#curr1").val(),curr2:$("#acc_curr").val()},function(a){if(a.length>0){var b=JSON.parse(a);$("#curr1").val()==$("#acc_curr").val()?$("#rate").val("1"):$("#rate").val(b.rate),$("#symbol").val(b.symbol)}})},validateProfitCalculateButton:function(){$("#noc").val()&&$("#open_price").val()&&$("#close_price").val()&&$("#point_value").html()?$("#futuresCalculateButton").hasClass("disabled")&&$("#futuresCalculateButton").removeClass("disabled"):$("#futuresCalculateButton").hasClass("disabled")||$("#futuresCalculateButton").addClass("disabled")},disableDecimals:function(a){var b;b="us"==this.numberFormat?".":",";var c=a+"_price",d=c+"_parts",e=$("#"+c).val(),f=$("#"+c).attr("oldval");if(void 0!==f){var g=f.split(b),h=(g[0],g[1]),i=e.split(b),j=i[0];i[1];e=void 0!=i[1]?i[0]+b+i[1]:i[0];var k=$("#"+d).val();if(k&&0!=k){if(void 0==h)var l=j;else var l=j+b+h;$("#"+c).val(l),e=l}else $("#"+c).val(e)}$("#"+c).attr("oldval",e),this.validateProfitCalculateButton()},getNumericValue:function(a){return $(a).val().replace(/\,/g,".")},getNumericValueFromHTML:function(a){return $(a).html().replace(/\,/g,".")},removeExtraZeros:function(a){var b=".",c=""+a,d=c.indexOf(b),e=0;if(-1!=d){for(var f=c.length-1;f!=d&&"0"==c[f];f--)e++;e==c.length-d-1&&e++}return a=a.substring(0,c.length-e)},calculateProfit:function(){if($("#noc").val()&&$("#open_price").val()&&$("#close_price").val()&&$("#point_value").html()){var op=parseFloat(this.getNumericValue("#open_price")),cp=parseFloat(this.getNumericValue("#close_price")),noc=parseInt($("#noc").val()),pvs=$("#point_value").html(),pv=parseInt(pvs.replace(/^\D+/g,"")),ts=this.getNumericValueFromHTML("#tick_size");-1!=ts.indexOf("/")&&(ts=eval(ts));var tv=this.getNumericValueFromHTML("#tick_value"),rate=parseFloat($("#rate").val()),symbol=$("#symbol").val();if(1==$("#buysell_action").val())var pl=(cp-op)*noc*pv*rate,plt=(cp-op)/ts,plp=cp-op;else var pl=(op-cp)*noc*pv*rate,plt=(op-cp)/ts,plp=op-cp;pl>=0?$("#p_l").html(symbol+this.removeExtraZeros(pl.toFixed(2))):(pl=-1*pl,$("#p_l").html("-"+symbol+this.removeExtraZeros(pl.toFixed(2)))),$("#p_l_ticks").html(this.removeExtraZeros(plt.toFixed(2))),$("#p_l_points").html(this.removeExtraZeros(plp.toFixed(4)))}},changedPart:function(a){var b=$("#"+a+"_price_parts").val(),c=parseInt($("#"+a+"_price_parts").attr("base")),d=b/c,e=""+(Math.floor(this.getNumericValue("#"+a+"_price"))+d);"eu"==this.numberFormat&&(e=e.replace(/\./g,",")),$("#"+a+"_price").val(e),$("#"+a+"_price").attr("oldval",e)},checkEnterForFPCSearch:function(a){var b=this;if(13==a.keyCode){var c=0;try{c=b.resultsData[b.rowNumber-1].pair_ID}catch(d){try{c=b.resultsData[0].pair_ID}catch(d){}}if(c){$("#fpcSearchPopupResults").addClass("displayNone"),$("#fpcSearchPopupResults").html(""),b.searchDeafaultVale="";var e="",f="";try{e=b.resultsData[b.rowNumber-1].label.replace(/<\/?[^>]+(>|$)/g,""),f=b.resultsData[b.rowNumber-1].flag}catch(d){try{e=b.resultsData[0].label.replace(/<\/?[^>]+(>|$)/g,""),f=b.resultsData[0].flag}catch(d){}}$("#searchBoxTop .ceFlags").remove(),$("#fpcSearchText").before('<span class="ceFlags '+f+'"></span>'),calc.futuresPairSelected(c,e)}return!1}}},$(document).ready(function(){$("#curr_pair").change(function(){calc.getLastPairsCurr($("#curr_pair :selected").attr("p"))}),$("#calc_form input").keypress(function(a){if(13==a.keyCode){if(!calc.someFlag)return calc.submitProfitCalculator(),!1;calc.someFlag=!1}});var a={};a.searchTextInputId="fpcSearchText",a.formElementId="search_0bottom",a.resultsInnerContainerId="innerContainerEC",a.resultsOuterContainerId="fpcSearchPopupResults",a.url="/tools/service/futures-search-auto-complete",a.hiddenDocDirectionId="doc_dirfpcSearchPopupResults",a.mainResultRowIdPrefix="searchRowIdEC_",a.hasDefaultText=!1,a.isPositionSearch=!0,a.minimumChar=2,a.newSearchWidget=!0;var b=new FXautoComplete(null,a);b.inputFieldBind($("#fpcSearchText")),b.getSymbol=function(a){$("#searchBoxTop .ceFlags").remove();var b=$("td:first",a).html(),c=b.split("</span>");return $("#fpcSearchText").before(c[0]+"</span>"),c[1]},$("#fpcSearchText").bind("input",function(){0==this.value.length&&calc.clearProfitForm(!1)}),b.buildSearchResults=function(a){var c=this,d='<div class="textBox clear" id="innerContainerEC"> <table>';if(null!==a){"object"==typeof a&&a.All instanceof Array&&(a=a.All),b.firstRowId=0;var e=" hoverSearch";$.each(a,function(a,f){if(void 0!==f){a++;var g=b.boldSymbol(b.searchText,f.label);d+='<tr class="row'+e+'" pair_id="'+f.pair_ID+'" id="'+c.Element.mainResultRowIdPrefix+a+'">',d+='<td class="first"><span class="ceFlags '+f.flag+'"></span>'+f.symbol+'</td><td class="second" title="'+f.label+'">'+g+'</td><td class="third" title="'+f.exchg+'">'+f.exchg+"</td>",d+="</tr>",e=""}}),d+="</table></div>",$("#"+c.Element.resultsOuterContainerId).html(d)}},b.bindResults=function(a){var c=this;$(a).click(function(){$("#searchBoxTop .ceFlags").remove();var d=a.cells[0].innerHTML,e=d.split("</span>");$("#fpcSearchText").before(e[0]+"</span>");var f=this.cells[1].innerHTML.replace(/<\/?[^>]+(>|$)/g,"");calc.futuresPairSelected($(a).attr("pair_id"),f),b.closeAutocomplete.call(c,c)})};var c={};c.searchTextInputId="forexSearchText",c.formElementId="search_0bottom",c.resultsInnerContainerId="innerContainerForex",c.resultsOuterContainerId="forexSearchPopupResults",c.url="/tools/service/forex-search-auto-complete",c.hiddenDocDirectionId="doc_dirforexSearchPopupResults",c.mainResultRowIdPrefix="searchRowIdForex_",c.hasDefaultText=!1,c.isPositionSearch=!0,c.minimumChar=2,c.newSearchWidget=!0;var d=new FXautoComplete(null,c);d.inputFieldBind($("#forexSearchText")),d.getSymbol=function(a){$("#forexsearchBoxTop .ceFlags").remove();var b=$("td:first",a).html();return b},$("#forexSearchText").bind("input",function(){0==this.value.length&&calc.clearForexForm()}),d.buildSearchResults=function(a){var b=this,c='<div class="textBox clear" id="innerContainerForex"> <table>';if(null!==a){"object"==typeof a&&a.All instanceof Array&&(a=a.All),d.firstRowId=0;var e=" hoverSearch";$.each(a,function(a,f){if(void 0!==f){a++;var g=d.boldSymbol(d.searchText,f.label);c+='<tr class="row'+e+'" pair_id="'+f.pair_ID+'" id="'+b.Element.mainResultRowIdPrefix+a+'">',c+='<td class="first">'+f.symbol+'</td><td class="second">'+g+"</td>",f.exchg&&(c+='<td class="third">'+f.exchg+"</td>"),c+="</tr>",e=""}}),c+="</table></div>",$("#"+b.Element.resultsOuterContainerId).html(c)}},d.bindResults=function(a){var b=this;$(a).click(function(){var c=this.cells[0].innerHTML.replace(/<\/?[^>]+(>|$)/g,"");calc.forexPairSelected($(a).attr("pair_id"),c),$("#forex_pair_id").val($(a).attr("pair_id")),d.closeAutocomplete.call(b,b)})}});