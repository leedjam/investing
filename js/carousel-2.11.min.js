// File: carousel.js
var runCarousel=function(a,b,c,d,e,f,g,h,i,j){function k(){return F?Math.ceil((e.length-1)/D.pageSize):Math.ceil(e.length/D.pageSize)}function l(){0==I&&(I=F?D.pageSize+2:D.pageSize+1,H=F?2:1);var a=Math.min(I-1,e.length);return Q="rtl"==c?a+"-"+H+" "+d+" "+e.length:H+"-"+a+" "+d+" "+e.length}function m(){x=setInterval(function(){L&&0==$(b+":hover").length&&(E.moveItem(A),$(".boxedTitle .articleItem:first-child",b).addClass("selected"))},P)}function n(){L=!0,clearInterval(x),m()}function o(){L=!1}function p(a){$(".hugeTitle",b).find("#vast-video-container").length||(M||(M=!0,$(".hugeTitle",b).addClass("oldArticle"),$(".hugeTitle",b).before('<div class="hugeTitle" style="z-index:1;">'+(g?g.apply(E,[q(a)]):"")+"</div>"),$(".hugeTitle img",b).fitImage(f.big),setTimeout(function(){$(".hugeTitle",b).removeAttr("style"),$(".hugeTitle",b).addClass("currentArticle js-current-article"),$(".oldArticle",b).remove(),M=!1},100)),J=a)}function q(a){for(var b=0;b<e.length;b++)if(a==Number(e[b].newsID))return b}function r(a,b){0==I&&(H=1,l(),I=0),a!=b&&p(a)}function s(){"ltr"==c?(z=10,A="next"):(z=0,A="prev"),$(".hugeTitle .newsCounter",b).html(l())}function t(a,b){E.preLoaded||(a||(a=0),b||(b=e.length),e.slice(a,b).forEach(function(a){if(a&&!a.preLoaded){var b,c;for(c in O)b=a[O[c]],b&&!N[b]&&(N[b]=new Image,N[b].src=b);a.preLoaded=!0}}),b>=e.length&&(E.preLoaded=!0))}function u(){$(".boxedTitle .articleItem",b).each(function(a){e[a]&&$(this).attr("data-id",e[a].newsID).attr("id",e[a].newsID)}),e[0]&&$(".hugeTitle:first",b).data("id",e[0].newsID)}var v,w,x,y,z,A,B,C={pageSize:4,itemWidth:648},D=$.extend(!1,C,f.dimensions),E=this,F="1"===a,G=!1,H=0,I=0,J=$(".hugeTitle",b).data("id"),K=$(".magicLine",b),L=!0,M=!1,N={},O=["imgMed","imgSmall","big_thumbnail","small_thumbnail"],P=7e4,Q=0;this.getCarouselItems=function(){return e},this.findNewsIndex=q,this.getIndexCounterText=function(){return Q},this.setIndexCounterText=l,this.moveItem=function(a){function d(){n.attr("disabled",!1),j&&j.apply(E,[E.getIndexCounterText(),H-1,Math.min(I-1,e.length)-1],E.pageIdx)}function f(){var c=$.Deferred(),d="prev"==a;return G=d,$(".boxedTitle .boxedTitleContainer",b)[d?"before":"after"]($(v)),$(".boxedTitle .boxedTitleContainer",b).animate({left:d?"+="+D.itemWidth+"px":"-="+D.itemWidth+"px"},200),setTimeout(function(){$(".boxedTitle .boxedTitleContainer:"+(d?"last":"first"),b).remove(),F||(p($(".boxedTitle .articleItem:first",b).attr("id")),$(".boxedTitle .articleItem:first",b).addClass("selected"),y=$(".boxedTitle ARTICLE.selected",b).position().left+z,10==y&&(y=0),K.stop().animate({left:y},200)),c.resolve()},200),c.promise()}function g(a){0==E.pageIdx?E.pageIdx=a-1:E.pageIdx=(E.pageIdx-1)%a}function m(a){var b=k();for(v=$("<div>"),"rtl"!=c?"next"==a?E.pageIdx=(E.pageIdx+1)%b:g(b):"prev"==a?E.pageIdx=(E.pageIdx+1)%b:g(b),w=E.pageIdx,H=F?E.pageIdx*D.pageSize+1:E.pageIdx*D.pageSize,I=H+D.pageSize,$(v).css("left","prev"==a?-D.itemWidth:D.itemWidth),$(v).attr("data-id",w),$(v).attr("id","boxedTitleContainer"+w),$(v).addClass("boxedTitleContainer js-articles");H<I;)e[H]&&(e[H].newsID=e[H].newsID?e[H].newsID:"1",$(v).append(h?h.apply(E,[q(e[H].newsID)]):"")),H++;I++,H=I-D.pageSize}var n=$(".boxedTitle .arrowBox",b);return!n.attr("disabled")&&(n.attr("disabled",!0),m(a),$(".hugeTitle .newsCounter",b).html(l()),f().then(d),i&&i.apply(E,[E.getIndexCounterText(),H-1,Math.min(I-1,e.length)-1],E.pageIdx),void window.bindInStripArticles())},this.getSelectedVideoArticle=function(){return $("article.selected",b)},this.getSelectedIndex=function(){return w},this.getMoveNextDirection=function(){return"ltr"===c?"next":"prev"},this.getMovePrevDirection=function(){return"ltr"===c?"prev":"next"},this.preLoad=t,E.preLoaded=!1,this.$container=$(b),this.pageIdx=0,t(0,D.pageSize+1),$(document).ready(function(){E.$container=$(b),E.$container.find(".newsCounter").text(l()),m(),$(".arrowBox",b).click(function(a){var b=$(this).is(".left")?"prev":"next";E.moveItem(b)})}),s(),u(),F||$(document).on("mouseenter",b+" .boxedTitle ARTICLE",function(a){o(),clearTimeout(B);var c=$(this).data("id");B=setTimeout(function(a){r(c,J),$(".boxedTitle ARTICLE",b).removeClass("selected"),$(".boxedTitle ARTICLE#"+c,b).addClass("selected"),y=$(">a",a).position().left,K.stop().animate({left:y},200)},200,this),K.data("origLeft",K.position().left)}),$(document).on("mouseenter",b+" .hugeTitle, .arrowBox",o),$(document).on("mouseleave",b+".carousel",function(){clearTimeout(B),n()});var R=$(".boxedTitle .arrowBox",b);return e.length<=f.dimensions.pageSize&&R.remove(),E};